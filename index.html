<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RuTara Web</title>
  <link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body {
      background-color: #000040;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    .logo {
      width: 128px;
    }
    .input-box {
      margin: 10px auto;
      padding: 10px;
      width: 300px;
    }
    .output-box {
      margin: 10px;
      background: white;
      color: black;
      padding: 10px;
      border-radius: 5px;
      display: inline-block;
      width: 180px;
    }
    .jeep-image {
      width: 200px;
      height: 130px;
      border: 2px solid white;
      object-fit: cover;
      margin: 20px auto;
    }
    button {
      background-color: #c0c000;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      margin: 10px;
    }
  </style>
</head>
<body>
  <img src="images/RuTara updated.png" class="logo" onclick="alert('Biyahe mo, Planado!')" />

  <div>
    <textarea id="Address1" class="input-box" placeholder="Enter pickup address"></textarea><br />
    <textarea id="Address2" class="input-box" placeholder="Enter drop-off address"></textarea><br />
    <button onclick="findJeep()">Find me a jeep</button>
  </div>

  <div>
    <div class="output-box" id="finalAddress"></div>
    <div class="output-box" id="jeepType"></div>
  </div>

  <img id="jeepPic" class="jeep-image" src="images/jeepBG.png" alt="Jeep Preview" />
  <div id="map" style="height: 400px; width: 90%; margin: 20px auto; border: 2px solid white;"></div>

  <script>
    const jeepRoutes = [
    {
        name: "Malibay",
        from: "Malibay",
        to: "MOA",
        image: "jeepA",
        coords: [[120.98197982661377, 14.535333112520549],[121.00925145393822, 14.534243629925593]] ,
        landmarks: ["Magallanes", "Evangelista", "Cabrera", "Metropoint", "MRT", "LRT", "STI", "Harisson", "Roxas",
        "Bluebay", "Double Dragon", "Shell", "Shore", "Heritage", "Tramo", "Plaza"]
    },
    {
        name: "Dominga",
        from: "Dominga",
        to: "Libertad",
        image: "jeepB",
        coords: [[120.99873466590616, 14.547662776014228],[120.99782994479563, 14.558775344962784]]
    },
    {
        name: "Cabrera",
        from: "Cabrera",
        to: "Libertad",
        image: "jeepC",
        coords: [[120.99873466590616, 14.547662776014228],[121.00595154408414, 14.54327691706474]]
    },
    {
        name: "Evangelista",
        from: "Evangelista",
        to: "Libertad",
        image: "jeepD",
        coords: [[120.99873466590616, 14.547662776014228],[121.01194427919326, 14.540730762791382]]
    },
    {
        name: "Dian",
        from: "Dian",
        to: "Libertad",
        image: "jeepE",
        coords: [[120.99873466590616, 14.547662776014228],[121.00307132662662, 14.559460260744837]]
    },

      // Jeeps that just pass through Pasay
    {
        name: "Alabang",
        from: "Alabang",
        to: "Pasay Rotonda",
        image: "jeepF",
        coords: [[121.00038054378574, 14.539305881657619, ],[121.04547597078542, 14.419524645663536]]
    },
    {
        name: "Dapitan",
        from: "Dapitan",
        to: "Baclaran",
        image: "jeepG",
        coords: [[120.99834992456219, 14.534247616100144],[120.99695505492606, 14.619716832212314]]
    },
    {
        name: "MCU",
        from: "MCU",
        to: "Baclaran",
        image: "jeepH",
        coords: [[120.99834992456219, 14.534247616100144],[120.98681466924769, 14.658365985713615]]
    },
    {
        name: "PRC",
        from: "Buendia",
        to: "Chino Roces",
        image: "jeepI",
        coords: [[121.01704106553109, 14.57578453398394],[120.99756959779066, 14.554159031370235]]
    }
    ];


    const map = L.map('map').setView([14.5465, 121.0014], 14);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
    }).addTo(map);

    let currentRouteLine = null;

    async function findJeep() {
        const address1 = document.getElementById("Address1").value.trim().toLowerCase();
        const address2 = document.getElementById("Address2").value.trim().toLowerCase();

        // Set default in case no match is found
        let selectedRoute = null;

        for (let route of jeepRoutes) {
          const fromMatch = route.from.toLowerCase() === address1 ||
          (route.landmarks && route.landmarks.map(l => l.toLowerCase()).includes(address1));

          const toMatch = route.to.toLowerCase() === address2 ||
          (route.landmarks && route.landmarks.map(l => l.toLowerCase()).includes(address2));

          if (fromMatch && toMatch) {
            selectedRoute = route;
            break;
          }
          
          if (
            route.from.toLowerCase() === address1 &&
            route.to.toLowerCase() === address2
          ) {
            selectedRoute = route;
            break;
            }
        } 

        const finalText = `${address1} to ${address2}`;
        document.getElementById("finalAddress").innerText = finalText;

        if (selectedRoute) {
            document.getElementById("jeepType").innerText = selectedRoute.name;
            document.getElementById("jeepPic").src = `images/${selectedRoute.image}.jpg`;

            // Clear previous route
            if (currentRouteLine) {
                map.removeLayer(currentRouteLine);
            }

            // Draw new route on map
            await drawJeepRoute(selectedRoute.coords);
        }
        else {
            document.getElementById("jeepType").innerText = "No suitable jeep found";
            document.getElementById("jeepPic").src = "images/jeepDefault.jpg";

            if (currentRouteLine) {
                map.removeLayer(currentRouteLine);
                currentRouteLine = null;
                }
        }
    }

    async function drawJeepRoute(coords) {
    const apiKey = '5b3ce3597851110001cf62489a1956d8e8c34e918872382f3bbae839'; // ðŸ”‘ Replace with your actual OpenRouteService API key
    const url = 'https://api.openrouteservice.org/v2/directions/driving-car/geojson';

    const response = await fetch(url, {
        method: 'POST',
        headers: {
            'Authorization': apiKey,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            coordinates: coords
        })
    });

    const data = await response.json();

      // Remove old route if it exists
      if (currentRouteLine) {
        map.removeLayer(currentRouteLine);
      }

      currentRouteLine = L.geoJSON(data, {
        style: { color: 'green', weight: 5 }
      }).addTo(map);

      map.fitBounds(currentRouteLine.getBounds());
    }

  </script>
</body>
</html>
